"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ApplicationLoader_1 = require("../server/ApplicationLoader");
const ControllerRegistry_1 = require("../mvc/ControllerRegistry");
const DependencyRegistry_1 = require("../di/DependencyRegistry");
const bodyParser = require("body-parser");
const Express = require("express");
function bootstrap(klass, port) {
    if (klass.prototype instanceof ApplicationLoader_1.ApplicationLoader) {
        const application = DependencyRegistry_1.DependencyRegistry.get(klass);
        let server;
        before(done => {
            if (typeof port !== 'undefined') {
                server = application.server.listen(port, done);
            }
            else {
                server = application.server.listen(application.port, done);
            }
        });
        after(done => {
            server.close(done);
        });
    }
    else {
        const app = Express();
        app.use(bodyParser.json());
        app.use(bodyParser.urlencoded({ extended: true }));
        let server;
        before(done => {
            if (Array.isArray(klass)) {
                klass.forEach(controller => {
                    const routes = ControllerRegistry_1.ControllerRegistry.getRoutes(controller);
                    routes.forEach((route, baseUrl) => {
                        app.use(baseUrl, route);
                    });
                });
            }
            else {
                const routes = ControllerRegistry_1.ControllerRegistry.getRoutes(klass);
                routes.forEach((route, baseUrl) => {
                    app.use(baseUrl, route);
                });
            }
            if (typeof port !== 'undefined') {
                server = app.listen(port, done);
            }
            else {
                throw new Error('!!! you must provide a port when test controller');
            }
        });
        after(done => {
            server.close(done);
        });
    }
}
exports.bootstrap = bootstrap;
//# sourceMappingURL=bootstrap.js.map